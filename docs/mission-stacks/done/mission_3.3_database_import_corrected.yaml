version: "1.0"
name: "Database Import Analysis Mission"
description: "Check database completeness and verify all copilot files are imported"

steps:
  - id: "check_db_exists"
    name: "Check Database File Exists"
    step_type: "command"
    parameters:
      command: "ls"
      args: ["-la", "contextlite.db"]
    timeout_seconds: 30

  - id: "check_api_stats"
    name: "Check API Statistics"
    step_type: "command"
    parameters:
      command: "curl"
      args: ["-s", "http://localhost:8084/api/v1/stats"]
    timeout_seconds: 30

  - id: "check_workspace_files"
    name: "Count Workspace Files"
    step_type: "command"
    parameters:
      command: "find"
      args: [".", "-type", "f", "-name", "*.go", "-o", "-name", "*.md", "-o", "-name", "*.yaml", "-o", "-name", "*.yml", "-o", "-name", "*.toml", "-o", "-name", "*.json", "|", "wc", "-l"]
    timeout_seconds: 60

  - id: "check_indexing_status"
    name: "Check Recent Indexing Activity"
    step_type: "command"
    parameters:
      command: "curl"
      args: ["-s", "http://localhost:8084/api/v1/search?query=test&limit=1"]
    timeout_seconds: 30

  - id: "verify_important_files"
    name: "Verify Search Functionality"
    step_type: "command"
    parameters:
      command: "curl"
      args: ["-s", "http://localhost:8084/api/v1/search?query=contextlite&limit=5"]
    timeout_seconds: 30

  - id: "database_analysis"
    name: "Analyze Database Completeness"
    step_type: "llm"
    parameters:
      prompt: "Based on the database statistics, workspace file counts, and indexing activity, assess whether the database contains a complete representation of the workspace. Identify any potential gaps or missing files."
      model: "llama32-champion:latest"
      provider: "ollama"
      temperature: 0.1
      max_tokens: 1000
    depends_on: ["check_api_stats", "check_workspace_files", "check_indexing_status", "verify_important_files"]

  - id: "import_report"
    name: "Generate Import Status Report"
    step_type: "create_file"
    parameters:
      path: "docs/database/DATABASE_IMPORT_STATUS.md"
      content: "Database import analysis completed. See analysis results."
    depends_on: ["database_analysis"]

config:
  max_parallel_steps: 3
  timeout_seconds: 300
