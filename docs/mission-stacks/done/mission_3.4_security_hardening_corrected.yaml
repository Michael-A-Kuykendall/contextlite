version: "1.0"
name: "Security Hardening Mission"
description: "Implement security improvements and verify hardening measures"

steps:
  - id: "check_file_permissions"
    name: "Check Critical File Permissions"
    step_type: "command"
    parameters:
      command: "find"
      args: [".", "-name", "*.db", "-o", "-name", "*.log", "-o", "-name", "*.key", "-exec", "ls", "-la", "{}", ";"]
    timeout_seconds: 30

  - id: "verify_env_security"
    name: "Check Environment Variable Security"
    step_type: "command"
    parameters:
      command: "grep"
      args: ["-r", "API_KEY\\|SECRET\\|PASSWORD\\|TOKEN", ".", "--include=*.go", "--include=*.md"]
    timeout_seconds: 60

  - id: "check_http_headers"
    name: "Test Security Headers"
    step_type: "command"
    parameters:
      command: "curl"
      args: ["-I", "http://localhost:8084/api/v1/stats"]
    timeout_seconds: 30

  - id: "test_rate_limiting"
    name: "Test Rate Limiting"
    step_type: "command"
    parameters:
      command: "bash"
      args: ["-c", "for i in {1..10}; do curl -s -o /dev/null -w '%{http_code}\\n' http://localhost:8084/api/v1/stats; done"]
    timeout_seconds: 60

  - id: "check_input_validation"
    name: "Test Input Validation"
    step_type: "command"
    parameters:
      command: "curl"
      args: ["-X", "POST", "-H", "Content-Type: application/json", "-d", "{\"query\":\"<script>alert('xss')</script>\"}", "http://localhost:8084/api/v1/search"]
    timeout_seconds: 30

  - id: "security_hardening_analysis"
    name: "Analyze Security Hardening Status"
    step_type: "llm"
    parameters:
      prompt: "Based on the security tests for file permissions, environment variables, HTTP headers, rate limiting, and input validation, provide recommendations for security hardening improvements."
      model: "llama32-champion:latest"
      provider: "ollama"
      temperature: 0.1
      max_tokens: 1000
    depends_on: ["check_file_permissions", "verify_env_security", "check_http_headers", "test_rate_limiting", "check_input_validation"]

  - id: "hardening_report"
    name: "Generate Security Hardening Report"
    step_type: "create_file"
    parameters:
      path: "docs/security/SECURITY_HARDENING_REPORT.md"
      content: "Security hardening analysis completed. See recommendations."
    depends_on: ["security_hardening_analysis"]

config:
  max_parallel_steps: 2
  timeout_seconds: 300
